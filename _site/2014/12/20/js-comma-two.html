<!DOCTYPE html>
<html>

	<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<title>蒲荣龙的博客</title>
	<meta name="description" content="  看到《js语言精髓与编程实践》中讲解的js语法中运算符的二义性之逗号的二义性，做些笔记">

	<link rel="stylesheet" href="/css/bootstrap.css">
	<link rel="stylesheet" href="/css/main.css">
	<link rel="stylesheet" href="/css/code.css">
	<link rel="canonical" href="http://www.puronglong.com/2014/12/20/js-comma-two.html">
	<link rel="alternate" type="application/rss+xml" title="blog" href="http://www.puronglong.com/feed.xml">
</head>


	<body>

		<div class="pull-right right-sidebar">
	<p>标签：</p>
	
	<p>
	<a class="page-link" href="/tag/技术">技术</a>
	<span>（66）</span></p>
	
	<p>
	<a class="page-link" href="/tag/生活">生活</a>
	<span>（35）</span></p>
	
</div>
		
		<div class="pull-left left-sidebar">
			<ul class="header-list">
				<li><a class="page-link" href="/">Home</a></li>
				<li><a class="page-link" href="/about/">About</a></li>
				<li><a class="page-link" href="/feed.xml">RSS</a></li>
			</ul>
		</div>
		<div class="page-content">
			<div class="wrapper">
				<article class="post home" itemscope itemtype="http://schema.org/BlogPosting">

	<header class="post-header">
		<h1 class="post-title" itemprop="name headline">js语法中运算符的二义性之逗号“,”的二义性</h1>
		<p class="post-meta">2014-12-20</p>
	</header>

	<div class="post-content" itemprop="articleBody">
		<blockquote>
  <p>看到《js语言精髓与编程实践》中讲解的js语法中运算符的二义性之逗号的二义性，做些笔记</p>
</blockquote>

<p>我们先来看看这两个例子：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>	<span class="nx">alert</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="s1">'a=(1,2,3);'</span><span class="p">));</span><span class="c1">//示例1</span>
	<span class="nx">alert</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="s1">'a=1,2,3;'</span><span class="p">));</span><span class="c1">//示例2</span>
</code></pre>
</div>
<!-- more -->

<p>结果是两者都会弹出3,这种用法产生的混乱，是因为逗号“,”<strong>既可以是语法分隔符，又可以是运算符</strong>所导致的。在上面的示例1，示例2中，逗号都被作为<code class="highlighter-rouge">”连续运算符“</code>在使用。示例1中的括号是强制运算符，因此它的效果是运算如下表达式：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>	<span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
</code></pre>
</div>

<p>并将结果赋值给变量a。由于该表达式是三个（直接量的）单值表达式<code class="highlighter-rouge">连续运算</code>，其结果值是最后一个表达式，亦即是数值3.而示例2因为没有括号来强制优先级，因此按<strong>默认优先级</strong>会先完成赋值运算，效果时“变量a赋值为1”，示例2在完成赋值运算“a=1”之后，还仍将继续指向连续运算，而最后一个表达式就是直接量3。下面来看示例3：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>	<span class="nx">a</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,(</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span><span class="mi">6</span><span class="p">);</span><span class="c1">//示例3</span>
</code></pre>
</div>

<p>同样的，我们也可以知道示例3的结果是使变量a赋值为：</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">]</span>
</code></pre>
</div>

<p>这是因为表达式“(3,4,5)”将会被先运算并返回结果值5，作为数组声明时的一个元素。示例3中要强调的是，逗号在这里分别有“数组声明时的语法分隔符”和“连续运算符”两种作用。但是如果像示例4：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>	<span class="kd">var</span> <span class="nx">a</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">;</span><span class="c1">//示例4</span>
</code></pre>
</div>

<p>这样，逗号被解释成了语句var声明时用来分隔多个变量的<code class="highlighter-rouge">语法分隔符</code>，而不是<code class="highlighter-rouge">连续运算符</code>。而语句var要求用“,”号来分隔的是多个标识符，而数值2和数值3显然都不是合法的表只发，因此示例4的代码会在语法解释期就提示出错。存在同样混乱问题的，还有下面这个示例5的例子：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>	<span class="c1">//示例5.显示最后表达式的值"value:240"</span>
	<span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="mi">100</span><span class="p">;</span>
	<span class="nx">alert</span><span class="p">((</span><span class="nx">i</span><span class="o">+=</span><span class="mi">20</span><span class="p">,</span><span class="nx">i</span><span class="o">*=</span><span class="mi">2</span><span class="p">,</span><span class="s1">'value:'</span><span class="o">+</span><span class="nx">i</span><span class="p">));</span>
</code></pre>
</div>

<p>弹出<code class="highlighter-rouge">“value:240”</code>，因为在这个示例的alert()函数调用中，还存在一对括号，用来表示强制运算。因为alert()是函数，所以如果这样写：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>	<span class="nx">alert</span><span class="p">(</span><span class="nx">i</span><span class="o">+=</span><span class="mi">20</span><span class="p">,</span><span class="nx">i</span><span class="o">*=</span><span class="mi">2</span><span class="p">,</span><span class="s1">'value:'</span><span class="o">+</span><span class="nx">i</span><span class="p">);</span><span class="c1">//示例6</span>

	<span class="nx">alert</span><span class="p">()</span><span class="err">函数会理解为三个参数传入。而函数参数表的传值顺序是从左至右的，那么示例</span><span class="mi">6</span><span class="err">这行代码会被理解为：</span>

	<span class="nx">alert</span><span class="p">(</span><span class="mi">120</span><span class="p">,</span><span class="mi">240</span><span class="p">,</span><span class="s1">'value:240'</span><span class="p">);</span>
</code></pre>
</div>

<p>但alert()函数自身只会处理一个参数，因此最终显示的结果会是值<code class="highlighter-rouge">“120”</code>，而不是我们期望的<code class="highlighter-rouge">240</code>，但需要补充的是，这行代码执行完毕之后，变量i的值其实已经变成<code class="highlighter-rouge">240</code>了，为了让js理解这里的逗号“,”是连续运算符，而不是函数参数表的语法分隔符，我们在这里加入了一对强制(表达式)运算的括号，即是示例5，这样，由于外层的括号是函数调用符，因此将内部的</p>

<div class="highlighter-rouge"><pre class="highlight"><code>	<span class="p">(</span><span class="nx">i</span><span class="o">+=</span><span class="mi">20</span><span class="p">,</span><span class="nx">i</span><span class="o">*=</span><span class="mi">2</span><span class="p">,</span><span class="s1">'value:'</span><span class="o">+</span><span class="nx">i</span><span class="p">)</span>
</code></pre>
</div>

<p>理解为一个参数，并且是一个需要求值的表达式。因此这里的括号就顺理成章地理解成了“强制运算符”，下面的代码：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>	<span class="nx">i</span><span class="o">+=</span><span class="mi">20</span>
	<span class="nx">i</span><span class="o">*=</span><span class="mi">2</span>
	<span class="s1">'value:'</span><span class="o">+</span><span class="nx">i</span>
</code></pre>
</div>

<p>也就被作为这个强制运算符的一个运算元：由“,”连接起来的一个表达式。直到饶了这样大的一个圈子，逗号才被合理地解释为“连续运算符”。</p>

	</div>

</article>

			</div>
		</div>

		<footer class="site-footer">

	<div class="wrapper">

		<div class="footer-col-wrapper">

			<div>
				<ul class="social-media-list">
					
					<li>
						<a href="https://github.com/puronglong"><span class="icon icon--github"><svg viewBox="0 0 16 16"><path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/></svg>
</span><span class="username">puronglong</span></a>

					</li>
					
				</ul>
			</div>

		</div>

	</div>

</footer>

<script type="text/javascript">

	var a = "\n                                   _                                         \n _ __  _   _ _ __ ___  _ __   __ _| | ___  _ __   __ _   ___  __ _ _   _   _ \n| '_ \\| | | | '__/ _ \\| '_ \\ / _` | |/ _ \\| '_ \\ / _` | / __|/ _` | | | | (_)\n| |_) | |_| | | | (_) | | | | (_| | | (_) | | | | (_| | \\__ \\ (_| | |_| |  _ \n| .__/ \\__,_|_|  \\___/|_| |_|\\__, |_|\\___/|_| |_|\\__, | |___/\\__,_|\\__, | (_)\n|_|                          |___/               |___/             |___/     \n          _                                                                  \n  /\\  /\\ (_)                                                                 \n / /_/ / | |                                                                 \n/ __  /  | |                                                                 \n\\/ /_/   |_|            😃";
    console.info(a);

	document.addEventListener('visibilitychange', function() {
                document.title = document.hidden ? '崩溃了，来看一下':'小龙龙的个人博客~'
            });
</script>


	</body>

</html>
